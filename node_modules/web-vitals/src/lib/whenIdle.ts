

import {onHidden} from './onHidden.js';
import {runOnce} from './runOnce.js';


export const whenIdle = (cb: () => void): number => {
  const rIC = self.requestIdleCallback || self.setTimeout;

  let handle = -1;
  cb = runOnce(cb);
  
  
  if (document.visibilityState === 'hidden') {
    cb();
  } else {
    handle = rIC(cb);
    onHidden(cb);
  }
  return handle;
};
