



import { FirebaseApp, FirebaseNamespace } from '@firebase/app-types';
import { Observer, Subscribe } from '@firebase/util';
import { FirebaseError, ErrorFactory } from '@firebase/util';
import { Component, ComponentContainer, Name } from '@firebase/component';

export interface FirebaseServiceInternals {
  
  delete(): Promise<void>;
}



export interface FirebaseService {
  app: FirebaseApp;
  INTERNAL?: FirebaseServiceInternals;
}

export type AppHook = (event: string, app: FirebaseApp) => void;


export interface FirebaseServiceFactory {
  (
    app: FirebaseApp,
    extendApp?: (props: { [prop: string]: any }) => void,
    instanceString?: string
  ): FirebaseService;
}

export interface PlatformLoggerService {
  getPlatformInfoString(): string;
}


export interface FirebaseServiceNamespace<T extends FirebaseService> {
  (app?: FirebaseApp): T;
}

export interface FirebaseAuthTokenData {
  accessToken: string;
}

export interface FirebaseAppInternals {
  getToken(refreshToken?: boolean): Promise<FirebaseAuthTokenData | null>;
  getUid(): string | null;
  addAuthTokenListener(fn: (token: string | null) => void): void;
  removeAuthTokenListener(fn: (token: string | null) => void): void;
  analytics: {
    logEvent: (
      eventName: string,
      eventParams: { [key: string]: any },
      options?: { global: boolean }
    ) => void;
  };
}

export interface _FirebaseApp extends FirebaseApp {
  container: ComponentContainer;
  _addComponent<T extends Name>(component: Component<T>): void;
  _addOrOverwriteComponent<T extends Name>(component: Component<T>): void;
  _removeServiceInstance(name: string, instanceIdentifier?: string): void;
}
export interface _FirebaseNamespace extends FirebaseNamespace {
  INTERNAL: {
    
    registerComponent<T extends Name>(
      component: Component<T>
    ): FirebaseServiceNamespace<FirebaseService> | null;

    
    createFirebaseNamespace(): FirebaseNamespace;

    
    extendNamespace(props: { [prop: string]: any }): void;

    
    createSubscribe<T>(
      executor: (observer: Observer<T>) => void,
      onNoObservers?: (observer: Observer<T>) => void
    ): Subscribe<T>;

    
    deepExtend(target: any, source: any): any;

    
    removeApp(name: string): void;

    
    components: Map<string, Component>;

    
    useAsService(app: FirebaseApp, serviceName: string): string | null;

    
    ErrorFactory: typeof ErrorFactory;
  };
}

declare module '@firebase/component' {
  interface NameServiceMapping {
    'platform-logger': PlatformLoggerService;
  }
}
