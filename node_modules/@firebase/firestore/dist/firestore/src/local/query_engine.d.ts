
import { Query } from '../core/query';
import { SnapshotVersion } from '../core/snapshot_version';
import { DocumentKeySet, DocumentMap } from '../model/collections';
import { IndexManager } from './index_manager';
import { LocalDocumentsView } from './local_documents_view';
import { PersistencePromise } from './persistence_promise';
import { PersistenceTransaction } from './persistence_transaction';
import { QueryContext } from './query_context';

export declare class QueryEngine {
    private localDocumentsView;
    private indexManager;
    private initialized;
    indexAutoCreationEnabled: boolean;
    
    indexAutoCreationMinCollectionSize: number;
    relativeIndexReadCostPerDocument: number;
    
    initialize(localDocuments: LocalDocumentsView, indexManager: IndexManager): void;
    
    getDocumentsMatchingQuery(transaction: PersistenceTransaction, query: Query, lastLimboFreeSnapshotVersion: SnapshotVersion, remoteKeys: DocumentKeySet): PersistencePromise<DocumentMap>;
    createCacheIndexes(transaction: PersistenceTransaction, query: Query, context: QueryContext, resultSize: number): PersistencePromise<void>;
    
    private performQueryUsingIndex;
    
    private performQueryUsingRemoteKeys;
    
    private applyQuery;
    
    private needsRefill;
    private executeFullCollectionScan;
    
    private appendRemainingResults;
}
