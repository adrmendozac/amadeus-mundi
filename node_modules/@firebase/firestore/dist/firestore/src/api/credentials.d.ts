
import { FirebaseApp } from '@firebase/app';
import { AppCheckInternalComponentName } from '@firebase/app-check-interop-types';
import { FirebaseAuthInternalName } from '@firebase/auth-interop-types';
import { Provider } from '@firebase/component';
import { User } from '../auth/user';
import { AsyncQueue } from '../util/async_queue';

export type AuthTokenFactory = () => string;

export interface FirstPartyCredentialsSettings {
    ['type']: 'firstParty';
    ['sessionIndex']: string;
    ['iamToken']: string | null;
    ['authTokenFactory']: AuthTokenFactory | null;
}
export interface ProviderCredentialsSettings {
    ['type']: 'provider';
    ['client']: CredentialsProvider<User>;
}

export type CredentialsSettings = FirstPartyCredentialsSettings | ProviderCredentialsSettings;
export type TokenType = 'OAuth' | 'FirstParty' | 'AppCheck';
export interface Token {
    
    type: TokenType;
    
    user?: User;
    
    headers: Map<string, string>;
}
export declare class OAuthToken implements Token {
    user: User;
    type: TokenType;
    headers: Map<any, any>;
    constructor(value: string, user: User);
}

export type CredentialChangeListener<T> = (credential: T) => Promise<void>;

export interface CredentialsProvider<T> {
    
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<T>): void;
    
    getToken(): Promise<Token | null>;
    
    invalidateToken(): void;
    shutdown(): void;
}

export declare class EmptyAuthCredentialsProvider implements CredentialsProvider<User> {
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<User>): void;
    shutdown(): void;
}

export declare class EmulatorAuthCredentialsProvider implements CredentialsProvider<User> {
    private token;
    constructor(token: Token);
    
    private changeListener;
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<User>): void;
    shutdown(): void;
}

export declare class LiteAuthCredentialsProvider implements CredentialsProvider<User> {
    private auth;
    constructor(authProvider: Provider<FirebaseAuthInternalName>);
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<User>): void;
    shutdown(): void;
}
export declare class FirebaseAuthCredentialsProvider implements CredentialsProvider<User> {
    private authProvider;
    
    private tokenListener;
    
    private currentUser;
    
    private tokenCounter;
    private forceRefresh;
    private auth;
    constructor(authProvider: Provider<FirebaseAuthInternalName>);
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<User>): void;
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    shutdown(): void;
    private getUser;
}
export declare class FirstPartyToken implements Token {
    private readonly sessionIndex;
    private readonly iamToken;
    private readonly authTokenFactory;
    type: TokenType;
    user: User;
    private _headers;
    constructor(sessionIndex: string, iamToken: string | null, authTokenFactory: AuthTokenFactory | null);
    
    private getAuthToken;
    get headers(): Map<string, string>;
}
export declare class FirstPartyAuthCredentialsProvider implements CredentialsProvider<User> {
    private sessionIndex;
    private iamToken;
    private authTokenFactory;
    constructor(sessionIndex: string, iamToken: string | null, authTokenFactory: AuthTokenFactory | null);
    getToken(): Promise<Token | null>;
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<User>): void;
    shutdown(): void;
    invalidateToken(): void;
}
export declare class AppCheckToken implements Token {
    private value;
    type: TokenType;
    headers: Map<any, any>;
    constructor(value: string);
}
export declare class FirebaseAppCheckTokenProvider implements CredentialsProvider<string> {
    private appCheckProvider;
    
    private tokenListener;
    private forceRefresh;
    private appCheck;
    private latestAppCheckToken;
    private serverAppAppCheckToken;
    constructor(app: FirebaseApp, appCheckProvider: Provider<AppCheckInternalComponentName>);
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<string>): void;
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    shutdown(): void;
}

export declare class EmptyAppCheckTokenProvider implements CredentialsProvider<string> {
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<string>): void;
    shutdown(): void;
}

export declare class LiteAppCheckTokenProvider implements CredentialsProvider<string> {
    private appCheckProvider;
    private appCheck;
    private serverAppAppCheckToken;
    constructor(app: FirebaseApp, appCheckProvider: Provider<AppCheckInternalComponentName>);
    getToken(): Promise<Token | null>;
    invalidateToken(): void;
    start(asyncQueue: AsyncQueue, changeListener: CredentialChangeListener<string>): void;
    shutdown(): void;
}

export declare function makeAuthCredentialsProvider(credentials?: CredentialsSettings): CredentialsProvider<User>;
