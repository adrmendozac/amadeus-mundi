
import { EmptyAuthCredentialsProvider } from '../../../src/api/credentials';
import { SnapshotVersion } from '../../../src/core/snapshot_version';
import { MutationResult } from '../../../src/model/mutation';
import { PersistentListenStream, PersistentWriteStream, WatchStreamListener, WriteStreamListener } from '../../../src/remote/persistent_stream';
import { DocumentWatchChange, ExistenceFilterChange, WatchTargetChange } from '../../../src/remote/watch_change';
import { AsyncQueueImpl } from '../../../src/util/async_queue_impl';
import { FirestoreError } from '../../../src/util/error';

type StreamEventType = 'handshakeComplete' | 'mutationResult' | 'watchChange' | 'open' | 'close' | 'connected';
declare class StreamStatusListener implements WatchStreamListener, WriteStreamListener {
    private pendingCallbacks;
    private pendingPromises;
    
    awaitCallback(expectedCallback: StreamEventType): Promise<void>;
    
    verifyNoPendingCallbacks(): void;
    onHandshakeComplete(): Promise<void>;
    onMutationResult(commitVersion: SnapshotVersion, results: MutationResult[]): Promise<void>;
    onWatchChange(watchChange: DocumentWatchChange | WatchTargetChange | ExistenceFilterChange, snapshot: SnapshotVersion): Promise<void>;
    onConnected(): Promise<void>;
    onOpen(): Promise<void>;
    onClose(err?: FirestoreError): Promise<void>;
    private resolvePending;
}
export declare function withTestWriteStream(fn: (writeStream: PersistentWriteStream, streamListener: StreamStatusListener, queue: AsyncQueueImpl) => Promise<void>, credentialsProvider?: EmptyAuthCredentialsProvider): Promise<void>;
export declare function withTestWatchStream(fn: (watchStream: PersistentListenStream, streamListener: StreamStatusListener) => Promise<void>): Promise<void>;
export {};
