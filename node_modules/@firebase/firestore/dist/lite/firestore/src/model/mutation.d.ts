
import { SnapshotVersion } from '../core/snapshot_version';
import { Timestamp } from '../lite-api/timestamp';
import { Value as ProtoValue } from '../protos/firestore_proto_api';
import { Document, MutableDocument } from './document';
import { DocumentKey } from './document_key';
import { FieldMask } from './field_mask';
import { ObjectValue } from './object_value';
import { FieldPath } from './path';
import { TransformOperation } from './transform_operation';

export declare class FieldTransform {
    readonly field: FieldPath;
    readonly transform: TransformOperation;
    constructor(field: FieldPath, transform: TransformOperation);
}
export declare function fieldTransformEquals(left: FieldTransform, right: FieldTransform): boolean;
export declare function fieldTransformsAreEqual(left?: FieldTransform[], right?: FieldTransform[]): boolean;

export declare class MutationResult {
    
    readonly version: SnapshotVersion;
    
    readonly transformResults: Array<ProtoValue | null>;
    constructor(
    
    version: SnapshotVersion, 
    
    transformResults: Array<ProtoValue | null>);
}
export declare const enum MutationType {
    Set = 0,
    Patch = 1,
    Delete = 2,
    Verify = 3
}

export declare class Precondition {
    readonly updateTime?: SnapshotVersion | undefined;
    readonly exists?: boolean | undefined;
    private constructor();
    
    static none(): Precondition;
    
    static exists(exists: boolean): Precondition;
    
    static updateTime(version: SnapshotVersion): Precondition;
    
    get isNone(): boolean;
    isEqual(other: Precondition): boolean;
}

export declare function preconditionIsValidForDocument(precondition: Precondition, document: MutableDocument): boolean;

export declare abstract class Mutation {
    abstract readonly type: MutationType;
    abstract readonly key: DocumentKey;
    abstract readonly precondition: Precondition;
    abstract readonly fieldTransforms: FieldTransform[];
    
    abstract getFieldMask(): FieldMask | null;
}

export declare function calculateOverlayMutation(doc: MutableDocument, mask: FieldMask | null): Mutation | null;

export declare function mutationApplyToRemoteDocument(mutation: Mutation, document: MutableDocument, mutationResult: MutationResult): void;

export declare function mutationApplyToLocalView(mutation: Mutation, document: MutableDocument, previousMask: FieldMask | null, localWriteTime: Timestamp): FieldMask | null;

export declare function mutationExtractBaseValue(mutation: Mutation, document: Document): ObjectValue | null;
export declare function mutationEquals(left: Mutation, right: Mutation): boolean;

export declare class SetMutation extends Mutation {
    readonly key: DocumentKey;
    readonly value: ObjectValue;
    readonly precondition: Precondition;
    readonly fieldTransforms: FieldTransform[];
    constructor(key: DocumentKey, value: ObjectValue, precondition: Precondition, fieldTransforms?: FieldTransform[]);
    readonly type: MutationType;
    getFieldMask(): FieldMask | null;
}

export declare class PatchMutation extends Mutation {
    readonly key: DocumentKey;
    readonly data: ObjectValue;
    readonly fieldMask: FieldMask;
    readonly precondition: Precondition;
    readonly fieldTransforms: FieldTransform[];
    constructor(key: DocumentKey, data: ObjectValue, fieldMask: FieldMask, precondition: Precondition, fieldTransforms?: FieldTransform[]);
    readonly type: MutationType;
    getFieldMask(): FieldMask | null;
}

export declare class DeleteMutation extends Mutation {
    readonly key: DocumentKey;
    readonly precondition: Precondition;
    constructor(key: DocumentKey, precondition: Precondition);
    readonly type: MutationType;
    readonly fieldTransforms: FieldTransform[];
    getFieldMask(): FieldMask | null;
}

export declare class VerifyMutation extends Mutation {
    readonly key: DocumentKey;
    readonly precondition: Precondition;
    constructor(key: DocumentKey, precondition: Precondition);
    readonly type: MutationType;
    readonly fieldTransforms: FieldTransform[];
    getFieldMask(): FieldMask | null;
}
