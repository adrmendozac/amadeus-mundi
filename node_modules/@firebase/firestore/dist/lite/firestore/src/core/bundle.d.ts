
import { LoadBundleTaskProgress } from '@firebase/firestore-types';
import { DocumentMap } from '../model/collections';
import { MutableDocument } from '../model/document';
import { DocumentKey } from '../model/document_key';
import { BundledDocumentMetadata as ProtoBundledDocumentMetadata } from '../protos/firestore_bundle_proto';
import { Document as ApiDocument, Timestamp as ApiTimestamp } from '../protos/firestore_proto_api';
import { Query } from './query';
import { SnapshotVersion } from './snapshot_version';

export interface BundledDocument {
    metadata: ProtoBundledDocumentMetadata;
    document?: ApiDocument;
}

export type BundledDocuments = BundledDocument[];
export interface BundleLoadResult {
    readonly progress: LoadBundleTaskProgress;
    readonly changedCollectionGroups: Set<string>;
    readonly changedDocs: DocumentMap;
}

export interface BundleMetadata {
    
    readonly id: string;
    
    readonly version: number;
    
    readonly createTime: SnapshotVersion;
}

export interface NamedQuery {
    
    readonly name: string;
    
    readonly query: Query;
    
    readonly readTime: SnapshotVersion;
}

export interface BundleConverter {
    toDocumentKey(name: string): DocumentKey;
    
    toMutableDocument(bundledDoc: BundledDocument): MutableDocument;
    toSnapshotVersion(time: ApiTimestamp): SnapshotVersion;
}
