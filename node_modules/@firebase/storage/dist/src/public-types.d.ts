
import { FirebaseApp, _FirebaseService } from '@firebase/app';
import { CompleteFn, NextFn, Subscribe, Unsubscribe } from '@firebase/util';
import { StorageError } from './implementation/error';

export interface FirebaseStorage extends _FirebaseService {
    
    readonly app: FirebaseApp;
    
    maxUploadRetryTime: number;
    
    maxOperationRetryTime: number;
}

export interface StorageReference {
    
    toString(): string;
    
    root: StorageReference;
    
    bucket: string;
    
    fullPath: string;
    
    name: string;
    
    storage: FirebaseStorage;
    
    parent: StorageReference | null;
}

export interface ListOptions {
    
    maxResults?: number | null;
    
    pageToken?: string | null;
}

export interface ListResult {
    
    prefixes: StorageReference[];
    
    items: StorageReference[];
    
    nextPageToken?: string;
}

export interface SettableMetadata {
    
    cacheControl?: string | undefined;
    
    contentDisposition?: string | undefined;
    
    contentEncoding?: string | undefined;
    
    contentLanguage?: string | undefined;
    
    contentType?: string | undefined;
    
    customMetadata?: {
        [key: string]: string;
    } | undefined;
}

export interface UploadMetadata extends SettableMetadata {
    
    md5Hash?: string | undefined;
}

export interface FullMetadata extends UploadMetadata {
    
    bucket: string;
    
    fullPath: string;
    
    generation: string;
    
    metageneration: string;
    
    name: string;
    
    size: number;
    
    timeCreated: string;
    
    updated: string;
    
    downloadTokens: string[] | undefined;
    
    ref?: StorageReference | undefined;
}

export type TaskEvent = 'state_changed';

export type TaskState = 'running' | 'paused' | 'success' | 'canceled' | 'error';

export interface StorageObserver<T> {
    next?: NextFn<T> | null;
    error?: (error: StorageError) => void | null;
    complete?: CompleteFn | null;
}

export interface UploadTask {
    
    cancel(): boolean;
    
    catch(onRejected: (error: StorageError) => unknown): Promise<unknown>;
    
    on(event: TaskEvent, nextOrObserver?: StorageObserver<UploadTaskSnapshot> | null | ((snapshot: UploadTaskSnapshot) => unknown), error?: ((a: StorageError) => unknown) | null, complete?: Unsubscribe | null): Unsubscribe | Subscribe<UploadTaskSnapshot>;
    
    pause(): boolean;
    
    resume(): boolean;
    
    snapshot: UploadTaskSnapshot;
    
    then(onFulfilled?: ((snapshot: UploadTaskSnapshot) => unknown) | null, onRejected?: ((error: StorageError) => unknown) | null): Promise<unknown>;
}

export interface UploadTaskSnapshot {
    
    bytesTransferred: number;
    
    metadata: FullMetadata;
    
    ref: StorageReference;
    
    state: TaskState;
    
    task: UploadTask;
    
    totalBytes: number;
}

export interface UploadResult {
    
    readonly metadata: FullMetadata;
    
    readonly ref: StorageReference;
}
declare module '@firebase/component' {
    interface NameServiceMapping {
        'storage': FirebaseStorage;
    }
}
