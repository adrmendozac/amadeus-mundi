
import { FunctionCall, FunctionResponse } from '../types';
import { LiveSession } from './live-session';

export interface AudioConversationController {
    
    stop: () => Promise<void>;
}

export interface StartAudioConversationOptions {
    
    functionCallingHandler?: (functionCalls: FunctionCall[]) => Promise<FunctionResponse>;
}

interface RunnerDependencies {
    audioContext: AudioContext;
    mediaStream: MediaStream;
    sourceNode: MediaStreamAudioSourceNode;
    workletNode: AudioWorkletNode;
}

export declare class AudioConversationRunner {
    private readonly liveSession;
    private readonly options;
    private readonly deps;
    
    private isStopped;
    
    private readonly stopDeferred;
    
    private readonly receiveLoopPromise;
    
    private readonly playbackQueue;
    
    private scheduledSources;
    
    private nextStartTime;
    
    private isPlaybackLoopRunning;
    constructor(liveSession: LiveSession, options: StartAudioConversationOptions, deps: RunnerDependencies);
    
    stop(): Promise<void>;
    
    private cleanup;
    
    private enqueueAndPlay;
    
    private interruptPlayback;
    
    private processPlaybackQueue;
    
    private runReceiveLoop;
}

export declare function startAudioConversation(liveSession: LiveSession, options?: StartAudioConversationOptions): Promise<AudioConversationController>;
export {};
