
import { Repo } from '../core/Repo';
import { Index } from '../core/snap/indexes/Index';
import { Node } from '../core/snap/Node';
import { Path } from '../core/util/Path';
import { Change } from '../core/view/Change';
import { CancelEvent, DataEvent, EventType } from '../core/view/Event';
import { CallbackContext, EventRegistration, QueryContext } from '../core/view/EventRegistration';
import { QueryParams } from '../core/view/QueryParams';
import { Database } from './Database';
import { OnDisconnect } from './OnDisconnect';
import { ListenOptions, Query as Query, DatabaseReference, Unsubscribe, ThenableReference } from './Reference';

export declare class QueryImpl implements Query, QueryContext {
    readonly _repo: Repo;
    readonly _path: Path;
    readonly _queryParams: QueryParams;
    readonly _orderByCalled: boolean;
    
    constructor(_repo: Repo, _path: Path, _queryParams: QueryParams, _orderByCalled: boolean);
    get key(): string | null;
    get ref(): DatabaseReference;
    get _queryIdentifier(): string;
    
    get _queryObject(): object;
    isEqual(other: QueryImpl | null): boolean;
    toJSON(): string;
    toString(): string;
}

export declare class ReferenceImpl extends QueryImpl implements DatabaseReference {
    
    constructor(repo: Repo, path: Path);
    get parent(): ReferenceImpl | null;
    get root(): ReferenceImpl;
}

export declare class DataSnapshot {
    readonly _node: Node;
    
    readonly ref: DatabaseReference;
    readonly _index: Index;
    
    constructor(_node: Node, 
    
    ref: DatabaseReference, _index: Index);
    
    get priority(): string | number | null;
    
    get key(): string | null;
    
    get size(): number;
    
    child(path: string): DataSnapshot;
    
    exists(): boolean;
    
    exportVal(): any;
    
    forEach(action: (child: IteratedDataSnapshot) => boolean | void): boolean;
    
    hasChild(path: string): boolean;
    
    hasChildren(): boolean;
    
    toJSON(): object | null;
    
    val(): any;
}

export interface IteratedDataSnapshot extends DataSnapshot {
    key: string;
}

export declare function ref(db: Database, path?: string): DatabaseReference;

export declare function refFromURL(db: Database, url: string): DatabaseReference;

export declare function child(parent: DatabaseReference, path: string): DatabaseReference;

export declare function onDisconnect(ref: DatabaseReference): OnDisconnect;
export interface ThenableReferenceImpl extends ReferenceImpl, Pick<Promise<ReferenceImpl>, 'then' | 'catch'> {
    key: string;
    parent: ReferenceImpl;
}

export declare function push(parent: DatabaseReference, value?: unknown): ThenableReference;

export declare function remove(ref: DatabaseReference): Promise<void>;

export declare function set(ref: DatabaseReference, value: unknown): Promise<void>;

export declare function setPriority(ref: DatabaseReference, priority: string | number | null): Promise<void>;

export declare function setWithPriority(ref: DatabaseReference, value: unknown, priority: string | number | null): Promise<void>;

export declare function update(ref: DatabaseReference, values: object): Promise<void>;

export declare function get(query: Query): Promise<DataSnapshot>;

export declare class ValueEventRegistration implements EventRegistration {
    private callbackContext;
    constructor(callbackContext: CallbackContext);
    respondsTo(eventType: string): boolean;
    createEvent(change: Change, query: QueryContext): DataEvent;
    getEventRunner(eventData: CancelEvent | DataEvent): () => void;
    createCancelEvent(error: Error, path: Path): CancelEvent | null;
    matches(other: EventRegistration): boolean;
    hasAnyCallback(): boolean;
}

export declare class ChildEventRegistration implements EventRegistration {
    private eventType;
    private callbackContext;
    constructor(eventType: string, callbackContext: CallbackContext | null);
    respondsTo(eventType: string): boolean;
    createCancelEvent(error: Error, path: Path): CancelEvent | null;
    createEvent(change: Change, query: QueryContext): DataEvent;
    getEventRunner(eventData: CancelEvent | DataEvent): () => void;
    matches(other: EventRegistration): boolean;
    hasAnyCallback(): boolean;
}

export declare function onValue(query: Query, callback: (snapshot: DataSnapshot) => unknown, cancelCallback?: (error: Error) => unknown): Unsubscribe;

export declare function onValue(query: Query, callback: (snapshot: DataSnapshot) => unknown, options: ListenOptions): Unsubscribe;

export declare function onValue(query: Query, callback: (snapshot: DataSnapshot) => unknown, cancelCallback: (error: Error) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildAdded(query: Query, callback: (snapshot: DataSnapshot, previousChildName?: string | null) => unknown, cancelCallback?: (error: Error) => unknown): Unsubscribe;

export declare function onChildAdded(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildAdded(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, cancelCallback: (error: Error) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildChanged(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, cancelCallback?: (error: Error) => unknown): Unsubscribe;

export declare function onChildChanged(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildChanged(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, cancelCallback: (error: Error) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildMoved(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, cancelCallback?: (error: Error) => unknown): Unsubscribe;

export declare function onChildMoved(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildMoved(query: Query, callback: (snapshot: DataSnapshot, previousChildName: string | null) => unknown, cancelCallback: (error: Error) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildRemoved(query: Query, callback: (snapshot: DataSnapshot) => unknown, cancelCallback?: (error: Error) => unknown): Unsubscribe;

export declare function onChildRemoved(query: Query, callback: (snapshot: DataSnapshot) => unknown, options: ListenOptions): Unsubscribe;

export declare function onChildRemoved(query: Query, callback: (snapshot: DataSnapshot) => unknown, cancelCallback: (error: Error) => unknown, options: ListenOptions): Unsubscribe;
export { EventType };

export declare function off(query: Query, eventType?: EventType, callback?: (snapshot: DataSnapshot, previousChildName?: string | null) => unknown): void;

export type QueryConstraintType = 'endAt' | 'endBefore' | 'startAt' | 'startAfter' | 'limitToFirst' | 'limitToLast' | 'orderByChild' | 'orderByKey' | 'orderByPriority' | 'orderByValue' | 'equalTo';

export declare abstract class QueryConstraint {
    
    abstract readonly type: QueryConstraintType;
    
    abstract _apply<T>(query: QueryImpl): QueryImpl;
}

export declare function endAt(value: number | string | boolean | null, key?: string): QueryConstraint;

export declare function endBefore(value: number | string | boolean | null, key?: string): QueryConstraint;

export declare function startAt(value?: number | string | boolean | null, key?: string): QueryConstraint;

export declare function startAfter(value: number | string | boolean | null, key?: string): QueryConstraint;

export declare function limitToFirst(limit: number): QueryConstraint;

export declare function limitToLast(limit: number): QueryConstraint;

export declare function orderByChild(path: string): QueryConstraint;

export declare function orderByKey(): QueryConstraint;

export declare function orderByPriority(): QueryConstraint;

export declare function orderByValue(): QueryConstraint;

export declare function equalTo(value: number | string | boolean | null, key?: string): QueryConstraint;

export declare function query(query: Query, ...queryConstraints: QueryConstraint[]): Query;
