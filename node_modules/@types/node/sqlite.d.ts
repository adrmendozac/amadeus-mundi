
declare module "node:sqlite" {
    type SQLInputValue = null | number | bigint | string | NodeJS.ArrayBufferView;
    type SQLOutputValue = null | number | bigint | string | Uint8Array;
    
    type SupportedValueType = SQLOutputValue;
    interface DatabaseSyncOptions {
        
        open?: boolean | undefined;
        
        enableForeignKeyConstraints?: boolean | undefined;
        
        enableDoubleQuotedStringLiterals?: boolean | undefined;
        
        readOnly?: boolean | undefined;
        
        allowExtension?: boolean | undefined;
        
        timeout?: number | undefined;
        
        readBigInts?: boolean | undefined;
        
        returnArrays?: boolean | undefined;
        
        allowBareNamedParameters?: boolean | undefined;
        
        allowUnknownNamedParameters?: boolean | undefined;
    }
    interface CreateSessionOptions {
        
        table?: string | undefined;
        
        db?: string | undefined;
    }
    interface ApplyChangesetOptions {
        
        filter?: ((tableName: string) => boolean) | undefined;
        
        onConflict?: ((conflictType: number) => number) | undefined;
    }
    interface FunctionOptions {
        
        deterministic?: boolean | undefined;
        
        directOnly?: boolean | undefined;
        
        useBigIntArguments?: boolean | undefined;
        
        varargs?: boolean | undefined;
    }
    interface AggregateOptions<T extends SQLInputValue = SQLInputValue> extends FunctionOptions {
        
        start: T | (() => T);
        
        step: (accumulator: T, ...args: SQLOutputValue[]) => T;
        
        result?: ((accumulator: T) => SQLInputValue) | undefined;
        
        inverse?: ((accumulator: T, ...args: SQLOutputValue[]) => T) | undefined;
    }
    
    class DatabaseSync implements Disposable {
        
        constructor(path: string | Buffer | URL, options?: DatabaseSyncOptions);
        
        aggregate(name: string, options: AggregateOptions): void;
        aggregate<T extends SQLInputValue>(name: string, options: AggregateOptions<T>): void;
        
        close(): void;
        
        loadExtension(path: string): void;
        
        enableLoadExtension(allow: boolean): void;
        
        location(dbName?: string): string | null;
        
        exec(sql: string): void;
        
        function(
            name: string,
            options: FunctionOptions,
            func: (...args: SQLOutputValue[]) => SQLInputValue,
        ): void;
        function(name: string, func: (...args: SQLOutputValue[]) => SQLInputValue): void;
        
        readonly isOpen: boolean;
        
        readonly isTransaction: boolean;
        
        open(): void;
        
        prepare(sql: string): StatementSync;
        
        createSession(options?: CreateSessionOptions): Session;
        
        applyChangeset(changeset: Uint8Array, options?: ApplyChangesetOptions): boolean;
        
        [Symbol.dispose](): void;
    }
    
    interface Session {
        
        changeset(): Uint8Array;
        
        patchset(): Uint8Array;
        
        close(): void;
    }
    interface StatementColumnMetadata {
        
        column: string | null;
        
        database: string | null;
        
        name: string;
        
        table: string | null;
        
        type: string | null;
    }
    interface StatementResultingChanges {
        
        changes: number | bigint;
        
        lastInsertRowid: number | bigint;
    }
    
    class StatementSync {
        private constructor();
        
        all(...anonymousParameters: SQLInputValue[]): Record<string, SQLOutputValue>[];
        all(
            namedParameters: Record<string, SQLInputValue>,
            ...anonymousParameters: SQLInputValue[]
        ): Record<string, SQLOutputValue>[];
        
        columns(): StatementColumnMetadata[];
        
        readonly expandedSQL: string;
        
        get(...anonymousParameters: SQLInputValue[]): Record<string, SQLOutputValue> | undefined;
        get(
            namedParameters: Record<string, SQLInputValue>,
            ...anonymousParameters: SQLInputValue[]
        ): Record<string, SQLOutputValue> | undefined;
        
        iterate(...anonymousParameters: SQLInputValue[]): NodeJS.Iterator<Record<string, SQLOutputValue>>;
        iterate(
            namedParameters: Record<string, SQLInputValue>,
            ...anonymousParameters: SQLInputValue[]
        ): NodeJS.Iterator<Record<string, SQLOutputValue>>;
        
        run(...anonymousParameters: SQLInputValue[]): StatementResultingChanges;
        run(
            namedParameters: Record<string, SQLInputValue>,
            ...anonymousParameters: SQLInputValue[]
        ): StatementResultingChanges;
        
        setAllowBareNamedParameters(enabled: boolean): void;
        
        setAllowUnknownNamedParameters(enabled: boolean): void;
        
        setReturnArrays(enabled: boolean): void;
        
        setReadBigInts(enabled: boolean): void;
        
        readonly sourceSQL: string;
    }
    interface BackupOptions {
        
        source?: string | undefined;
        
        target?: string | undefined;
        
        rate?: number | undefined;
        
        progress?: ((progressInfo: BackupProgressInfo) => void) | undefined;
    }
    interface BackupProgressInfo {
        totalPages: number;
        remainingPages: number;
    }
    
    function backup(sourceDb: DatabaseSync, path: string | Buffer | URL, options?: BackupOptions): Promise<number>;
    
    namespace constants {
        
        const SQLITE_CHANGESET_DATA: number;
        
        const SQLITE_CHANGESET_NOTFOUND: number;
        
        const SQLITE_CHANGESET_CONFLICT: number;
        
        const SQLITE_CHANGESET_FOREIGN_KEY: number;
        
        const SQLITE_CHANGESET_OMIT: number;
        
        const SQLITE_CHANGESET_REPLACE: number;
        
        const SQLITE_CHANGESET_ABORT: number;
    }
}
