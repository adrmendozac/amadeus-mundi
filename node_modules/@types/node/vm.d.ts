
declare module "vm" {
    import { ImportAttributes, ImportPhase } from "node:module";
    interface Context extends NodeJS.Dict<any> {}
    interface BaseOptions {
        
        filename?: string | undefined;
        
        lineOffset?: number | undefined;
        
        columnOffset?: number | undefined;
    }
    type DynamicModuleLoader<T> = (
        specifier: string,
        referrer: T,
        importAttributes: ImportAttributes,
        phase: ImportPhase,
    ) => Module | Promise<Module>;
    interface ScriptOptions extends BaseOptions {
        
        cachedData?: Buffer | NodeJS.ArrayBufferView | undefined;
        
        produceCachedData?: boolean | undefined;
        
        importModuleDynamically?:
            | DynamicModuleLoader<Script>
            | typeof constants.USE_MAIN_CONTEXT_DEFAULT_LOADER
            | undefined;
    }
    interface RunningScriptOptions extends BaseOptions {
        
        displayErrors?: boolean | undefined;
        
        timeout?: number | undefined;
        
        breakOnSigint?: boolean | undefined;
    }
    interface RunningScriptInNewContextOptions
        extends RunningScriptOptions, Pick<CreateContextOptions, "microtaskMode">
    {
        
        contextName?: CreateContextOptions["name"] | undefined;
        
        contextOrigin?: CreateContextOptions["origin"] | undefined;
        contextCodeGeneration?: CreateContextOptions["codeGeneration"] | undefined;
    }
    interface RunningCodeOptions extends RunningScriptOptions, Pick<ScriptOptions, "cachedData"> {
        
        importModuleDynamically?:
            | DynamicModuleLoader<Script>
            | typeof constants.USE_MAIN_CONTEXT_DEFAULT_LOADER
            | undefined;
    }
    interface RunningCodeInNewContextOptions
        extends RunningScriptInNewContextOptions, Pick<ScriptOptions, "cachedData">
    {
        
        importModuleDynamically?:
            | DynamicModuleLoader<Script>
            | typeof constants.USE_MAIN_CONTEXT_DEFAULT_LOADER
            | undefined;
    }
    interface CompileFunctionOptions extends BaseOptions, Pick<ScriptOptions, "cachedData" | "produceCachedData"> {
        
        parsingContext?: Context | undefined;
        
        contextExtensions?: Object[] | undefined;
        
        importModuleDynamically?:
            | DynamicModuleLoader<ReturnType<typeof compileFunction>>
            | typeof constants.USE_MAIN_CONTEXT_DEFAULT_LOADER
            | undefined;
    }
    interface CreateContextOptions {
        
        name?: string | undefined;
        
        origin?: string | undefined;
        codeGeneration?:
            | {
                
                strings?: boolean | undefined;
                
                wasm?: boolean | undefined;
            }
            | undefined;
        
        microtaskMode?: "afterEvaluate" | undefined;
        
        importModuleDynamically?:
            | DynamicModuleLoader<Context>
            | typeof constants.USE_MAIN_CONTEXT_DEFAULT_LOADER
            | undefined;
    }
    type MeasureMemoryMode = "summary" | "detailed";
    interface MeasureMemoryOptions {
        
        mode?: MeasureMemoryMode | undefined;
        
        execution?: "default" | "eager" | undefined;
    }
    interface MemoryMeasurement {
        total: {
            jsMemoryEstimate: number;
            jsMemoryRange: [number, number];
        };
    }
    
    class Script {
        constructor(code: string, options?: ScriptOptions | string);
        
        runInContext(contextifiedObject: Context, options?: RunningScriptOptions): any;
        
        runInNewContext(
            contextObject?: Context | typeof constants.DONT_CONTEXTIFY,
            options?: RunningScriptInNewContextOptions,
        ): any;
        
        runInThisContext(options?: RunningScriptOptions): any;
        
        createCachedData(): Buffer;
        
        cachedDataProduced?: boolean;
        
        cachedDataRejected?: boolean;
        cachedData?: Buffer;
        
        sourceMapURL: string | undefined;
    }
    
    function createContext(
        contextObject?: Context | typeof constants.DONT_CONTEXTIFY,
        options?: CreateContextOptions,
    ): Context;
    
    function isContext(sandbox: Context): boolean;
    
    function runInContext(code: string, contextifiedObject: Context, options?: RunningCodeOptions | string): any;
    
    function runInNewContext(
        code: string,
        contextObject?: Context | typeof constants.DONT_CONTEXTIFY,
        options?: RunningCodeInNewContextOptions | string,
    ): any;
    
    function runInThisContext(code: string, options?: RunningCodeOptions | string): any;
    
    function compileFunction(
        code: string,
        params?: readonly string[],
        options?: CompileFunctionOptions,
    ): Function & Pick<Script, "cachedData" | "cachedDataProduced" | "cachedDataRejected">;
    
    function measureMemory(options?: MeasureMemoryOptions): Promise<MemoryMeasurement>;
    interface ModuleEvaluateOptions extends Pick<RunningScriptOptions, "breakOnSigint" | "timeout"> {}
    type ModuleLinker = (
        specifier: string,
        referencingModule: Module,
        extra: {
            attributes: ImportAttributes;
        },
    ) => Module | Promise<Module>;
    type ModuleStatus = "unlinked" | "linking" | "linked" | "evaluating" | "evaluated" | "errored";
    
    class Module {
        
        error: any;
        
        identifier: string;
        context: Context;
        
        namespace: Object;
        
        status: ModuleStatus;
        
        evaluate(options?: ModuleEvaluateOptions): Promise<void>;
        
        link(linker: ModuleLinker): Promise<void>;
    }
    interface SourceTextModuleOptions extends Pick<ScriptOptions, "cachedData" | "columnOffset" | "lineOffset"> {
        
        identifier?: string | undefined;
        context?: Context | undefined;
        
        initializeImportMeta?: ((meta: ImportMeta, module: SourceTextModule) => void) | undefined;
        
        importModuleDynamically?: DynamicModuleLoader<SourceTextModule> | undefined;
    }
    
    interface ModuleRequest {
        
        specifier: string;
        
        attributes: ImportAttributes;
        
        phase: ImportPhase;
    }
    
    class SourceTextModule extends Module {
        
        constructor(code: string, options?: SourceTextModuleOptions);
        
        readonly dependencySpecifiers: readonly string[];
        
        instantiate(): void;
        
        linkRequests(modules: readonly Module[]): void;
        
        readonly moduleRequests: readonly ModuleRequest[];
    }
    interface SyntheticModuleOptions {
        
        identifier?: string | undefined;
        
        context?: Context | undefined;
    }
    
    class SyntheticModule extends Module {
        
        constructor(
            exportNames: string[],
            evaluateCallback: (this: SyntheticModule) => void,
            options?: SyntheticModuleOptions,
        );
        
        setExport(name: string, value: any): void;
    }
    
    namespace constants {
        
        const USE_MAIN_CONTEXT_DEFAULT_LOADER: number;
        
        const DONT_CONTEXTIFY: number;
    }
}
declare module "node:vm" {
    export * from "vm";
}
